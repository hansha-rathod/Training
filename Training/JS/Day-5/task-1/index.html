<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Task-1</title>

  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  <!-- Bootstrap (optional) -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="p-5">

  <div class="container">
    <h3 class="mb-4">Location Dropdown (AJAX)</h3>

    <!--Couuntry Dropdown-->
    <div class="mb-3">
        <label class="form-label">Country</label>
        <select id="countries" class="form-select">
          <option value="">Select Country</option>
        </select>
      </div>

    <!-- State Dropdown -->
    <div class="mb-3">
      <label class="form-label">State</label>
      <select id="state" class="form-select">
        <option value="">Select State</option>
      </select>
    </div>

    <!-- City Dropdown -->
    <div class="mb-3">
      <label class="form-label">City</label>
      <select id="city" class="form-select">
        <option value="">Select City</option>
      </select>
    </div>
  </div>

  <script>
    $(document).ready(function () {
    
       // LOAD COUNTRIES 
      $.ajax({
        url: "https://countriesnow.space/api/v0.1/countries",
        type: "GET",
        dataType: "json",
        success: function (response) {
    
          // Country list is inside response.data
          $.each(response.data, function (index, countryObj) {
            $("#countries").append(
              `<option value="${countryObj.country}"> ${countryObj.country} </option>`
            );
          });
        },
        error: function () {
          $("#countries").html('<option>Error loading countries</option>');
        }
      });
    
      // LOAD STATES

      $("#countries").change(function () {
        let selectedCountry = $(this).val();
    
        $("#state").html('<option>Loading...</option>');
        $("#city").html('<option>Select City</option>');
    
        if (selectedCountry !== "") {
          $.ajax({
            url: "https://countriesnow.space/api/v0.1/countries/states",
            type: "POST",
            dataType: "json",
            data: {
              country: selectedCountry
            },
            success: function (response) {
    
              $("#state").html('<option value="">Select State</option>');
    
              $.each(response.data.states, function (index, stateObj) {
                $("#state").append(
                  `<option value="${stateObj.name}">
                    ${stateObj.name}
                   </option>`
                );
              });
            },
            error: function () {
              alert("Error loading states");
            }
          });
        } else {
          $("#state").html('<option>Select State</option>');
        }
      });
    
      // LOAD CITIES
      $("#state").change(function () {
        let selectedState = $(this).val();
        let selectedCountry = $("#countries").val();
    
        $("#city").html('<option>Loading...</option>');
    
        if (selectedState !== "") {
          $.ajax({
            url: "https://countriesnow.space/api/v0.1/countries/state/cities",
            type: "POST",
            dataType: "json",
            data: {
              country: selectedCountry,
              state: selectedState
            },
            success: function (response) {
    
              $("#city").html('<option value="">Select City</option>');
    
              $.each(response.data, function (index, city) {
                $("#city").append(
                  `<option value="${city}">${city}</option>`
                );
              });
            },
            error: function () {
              alert("Error loading cities");
            }
          });
        } else {
          $("#city").html('<option>Select City</option>');
        }
      });
    
    });
    </script>
    
</body>
</html>
